<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>babel7 | gyz418</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.7c4bcbe6.css" as="style"><link rel="preload" href="/assets/js/app.6f322a7c.js" as="script"><link rel="preload" href="/assets/js/2.5281df64.js" as="script"><link rel="preload" href="/assets/js/34.564690e0.js" as="script"><link rel="prefetch" href="/assets/js/10.b5b78ec7.js"><link rel="prefetch" href="/assets/js/11.3979c63f.js"><link rel="prefetch" href="/assets/js/12.ad66bd03.js"><link rel="prefetch" href="/assets/js/13.8c156ce0.js"><link rel="prefetch" href="/assets/js/14.d5aaf7c9.js"><link rel="prefetch" href="/assets/js/15.744185ba.js"><link rel="prefetch" href="/assets/js/16.b223ec11.js"><link rel="prefetch" href="/assets/js/17.27940440.js"><link rel="prefetch" href="/assets/js/18.2561b5d6.js"><link rel="prefetch" href="/assets/js/19.bab52827.js"><link rel="prefetch" href="/assets/js/20.64459c18.js"><link rel="prefetch" href="/assets/js/21.95850c08.js"><link rel="prefetch" href="/assets/js/22.8b92906a.js"><link rel="prefetch" href="/assets/js/23.a2fee047.js"><link rel="prefetch" href="/assets/js/24.a1a3b298.js"><link rel="prefetch" href="/assets/js/25.ba19b2b6.js"><link rel="prefetch" href="/assets/js/26.753266fe.js"><link rel="prefetch" href="/assets/js/27.ee58b5d1.js"><link rel="prefetch" href="/assets/js/28.611ffe65.js"><link rel="prefetch" href="/assets/js/29.d446cc43.js"><link rel="prefetch" href="/assets/js/3.d5898f06.js"><link rel="prefetch" href="/assets/js/30.71c0d378.js"><link rel="prefetch" href="/assets/js/31.43e00d33.js"><link rel="prefetch" href="/assets/js/32.a6757d5d.js"><link rel="prefetch" href="/assets/js/33.bfb83c0e.js"><link rel="prefetch" href="/assets/js/35.77a7c9e4.js"><link rel="prefetch" href="/assets/js/36.5e974fda.js"><link rel="prefetch" href="/assets/js/37.f0956a85.js"><link rel="prefetch" href="/assets/js/38.c42b9666.js"><link rel="prefetch" href="/assets/js/39.7262da55.js"><link rel="prefetch" href="/assets/js/4.eb70c47d.js"><link rel="prefetch" href="/assets/js/40.95d088a9.js"><link rel="prefetch" href="/assets/js/41.f7067891.js"><link rel="prefetch" href="/assets/js/42.12cf6162.js"><link rel="prefetch" href="/assets/js/43.7970973b.js"><link rel="prefetch" href="/assets/js/44.701b85aa.js"><link rel="prefetch" href="/assets/js/45.4c06d258.js"><link rel="prefetch" href="/assets/js/46.e5e18c20.js"><link rel="prefetch" href="/assets/js/47.5d0f9322.js"><link rel="prefetch" href="/assets/js/48.03ad2213.js"><link rel="prefetch" href="/assets/js/49.65826398.js"><link rel="prefetch" href="/assets/js/5.8e0377fa.js"><link rel="prefetch" href="/assets/js/50.8a4a5a58.js"><link rel="prefetch" href="/assets/js/6.49592538.js"><link rel="prefetch" href="/assets/js/7.c7371c19.js"><link rel="prefetch" href="/assets/js/8.78f8209a.js"><link rel="prefetch" href="/assets/js/9.823e0afe.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7c4bcbe6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">gyz418</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/前端/es6.html" class="nav-link">
  es6
</a></li><li class="dropdown-item"><!----> <a href="/前端/vue.html" class="nav-link">
  vue
</a></li><li class="dropdown-item"><!----> <a href="/前端/ts.html" class="nav-link">
  ts
</a></li><li class="dropdown-item"><!----> <a href="/前端/flutter.html" class="nav-link">
  flutter
</a></li><li class="dropdown-item"><!----> <a href="/前端/css.html" class="nav-link">
  css
</a></li><li class="dropdown-item"><!----> <a href="/前端/git.html" class="nav-link">
  git
</a></li><li class="dropdown-item"><!----> <a href="/前端/webpack.html" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/前端/nodejs.html" class="nav-link">
  nodejs
</a></li><li class="dropdown-item"><!----> <a href="/前端/js优化.html" class="nav-link">
  js优化
</a></li><li class="dropdown-item"><!----> <a href="/前端/vue2源码.html" class="nav-link">
  vue2源码
</a></li><li class="dropdown-item"><!----> <a href="/前端/babel.html" class="nav-link">
  babel
</a></li><li class="dropdown-item"><!----> <a href="/前端/vue3.html" class="nav-link">
  vue3
</a></li><li class="dropdown-item"><!----> <a href="/前端/js设计模式.html" class="nav-link">
  js设计模式
</a></li><li class="dropdown-item"><!----> <a href="/前端/小程序.html" class="nav-link">
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/前端/package.json.html" class="nav-link">
  package.json
</a></li><li class="dropdown-item"><!----> <a href="/前端/github.html" class="nav-link">
  github
</a></li><li class="dropdown-item"><!----> <a href="/前端/eslint.html" class="nav-link">
  eslint
</a></li><li class="dropdown-item"><!----> <a href="/前端/nestjs.html" class="nav-link">
  nestjs
</a></li><li class="dropdown-item"><!----> <a href="/前端/ueditor.html" class="nav-link">
  ueditor
</a></li><li class="dropdown-item"><!----> <a href="/typescript.html" class="nav-link">
  typescript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端相关" class="dropdown-title"><span class="title">前端相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/gulp.html" class="nav-link">
  gulp
</a></li><li class="dropdown-item"><!----> <a href="/react.html" class="nav-link">
  react
</a></li><li class="dropdown-item"><!----> <a href="/js-tools.html" class="nav-link">
  js-tools
</a></li><li class="dropdown-item"><!----> <a href="/js特效.html" class="nav-link">
  js特效
</a></li><li class="dropdown-item"><!----> <a href="/old.html" class="nav-link">
  old
</a></li><li class="dropdown-item"><!----> <a href="/js概念.html" class="nav-link">
  js概念
</a></li><li class="dropdown-item"><!----> <a href="/jest.html" class="nav-link">
  jest
</a></li><li class="dropdown-item"><!----> <a href="/微前端.html" class="nav-link">
  微前端
</a></li><li class="dropdown-item"><!----> <a href="/service worker.html" class="nav-link">
  service worker
</a></li><li class="dropdown-item"><!----> <a href="/deno.html" class="nav-link">
  deno
</a></li><li class="dropdown-item"><!----> <a href="/swiper.html" class="nav-link">
  swiper
</a></li><li class="dropdown-item"><!----> <a href="/nginx.html" class="nav-link">
  nginx
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/chrome.html" class="nav-link">
  chrome
</a></li><li class="dropdown-item"><!----> <a href="/vscode.html" class="nav-link">
  vscode
</a></li><li class="dropdown-item"><!----> <a href="/webstorm.html" class="nav-link">
  webstorm
</a></li><li class="dropdown-item"><!----> <a href="/url.html" class="nav-link">
  url
</a></li><li class="dropdown-item"><!----> <a href="/pc.html" class="nav-link">
  pc
</a></li><li class="dropdown-item"><!----> <a href="/festival.html" class="nav-link">
  festival
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/前端/es6.html" class="nav-link">
  es6
</a></li><li class="dropdown-item"><!----> <a href="/前端/vue.html" class="nav-link">
  vue
</a></li><li class="dropdown-item"><!----> <a href="/前端/ts.html" class="nav-link">
  ts
</a></li><li class="dropdown-item"><!----> <a href="/前端/flutter.html" class="nav-link">
  flutter
</a></li><li class="dropdown-item"><!----> <a href="/前端/css.html" class="nav-link">
  css
</a></li><li class="dropdown-item"><!----> <a href="/前端/git.html" class="nav-link">
  git
</a></li><li class="dropdown-item"><!----> <a href="/前端/webpack.html" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/前端/nodejs.html" class="nav-link">
  nodejs
</a></li><li class="dropdown-item"><!----> <a href="/前端/js优化.html" class="nav-link">
  js优化
</a></li><li class="dropdown-item"><!----> <a href="/前端/vue2源码.html" class="nav-link">
  vue2源码
</a></li><li class="dropdown-item"><!----> <a href="/前端/babel.html" class="nav-link">
  babel
</a></li><li class="dropdown-item"><!----> <a href="/前端/vue3.html" class="nav-link">
  vue3
</a></li><li class="dropdown-item"><!----> <a href="/前端/js设计模式.html" class="nav-link">
  js设计模式
</a></li><li class="dropdown-item"><!----> <a href="/前端/小程序.html" class="nav-link">
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/前端/package.json.html" class="nav-link">
  package.json
</a></li><li class="dropdown-item"><!----> <a href="/前端/github.html" class="nav-link">
  github
</a></li><li class="dropdown-item"><!----> <a href="/前端/eslint.html" class="nav-link">
  eslint
</a></li><li class="dropdown-item"><!----> <a href="/前端/nestjs.html" class="nav-link">
  nestjs
</a></li><li class="dropdown-item"><!----> <a href="/前端/ueditor.html" class="nav-link">
  ueditor
</a></li><li class="dropdown-item"><!----> <a href="/typescript.html" class="nav-link">
  typescript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端相关" class="dropdown-title"><span class="title">前端相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/gulp.html" class="nav-link">
  gulp
</a></li><li class="dropdown-item"><!----> <a href="/react.html" class="nav-link">
  react
</a></li><li class="dropdown-item"><!----> <a href="/js-tools.html" class="nav-link">
  js-tools
</a></li><li class="dropdown-item"><!----> <a href="/js特效.html" class="nav-link">
  js特效
</a></li><li class="dropdown-item"><!----> <a href="/old.html" class="nav-link">
  old
</a></li><li class="dropdown-item"><!----> <a href="/js概念.html" class="nav-link">
  js概念
</a></li><li class="dropdown-item"><!----> <a href="/jest.html" class="nav-link">
  jest
</a></li><li class="dropdown-item"><!----> <a href="/微前端.html" class="nav-link">
  微前端
</a></li><li class="dropdown-item"><!----> <a href="/service worker.html" class="nav-link">
  service worker
</a></li><li class="dropdown-item"><!----> <a href="/deno.html" class="nav-link">
  deno
</a></li><li class="dropdown-item"><!----> <a href="/swiper.html" class="nav-link">
  swiper
</a></li><li class="dropdown-item"><!----> <a href="/nginx.html" class="nav-link">
  nginx
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/chrome.html" class="nav-link">
  chrome
</a></li><li class="dropdown-item"><!----> <a href="/vscode.html" class="nav-link">
  vscode
</a></li><li class="dropdown-item"><!----> <a href="/webstorm.html" class="nav-link">
  webstorm
</a></li><li class="dropdown-item"><!----> <a href="/url.html" class="nav-link">
  url
</a></li><li class="dropdown-item"><!----> <a href="/pc.html" class="nav-link">
  pc
</a></li><li class="dropdown-item"><!----> <a href="/festival.html" class="nav-link">
  festival
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>babel7</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/%E5%89%8D%E7%AB%AF/babel.html#babel7" class="sidebar-link">babel7</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/babel.html#webpack-babel环境" class="sidebar-link">webpack+babel环境</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/babel.html#babel7环境搭建简单版" class="sidebar-link">babel7环境搭建简单版</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/babel.html#ast" class="sidebar-link">ast</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/babel.html#ast-babel插件形式" class="sidebar-link">ast-babel插件形式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/babel.html#plugintest-js" class="sidebar-link">pluginTest.js</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/babel.html#babel-config-js" class="sidebar-link">babel.config.js</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/babel.html#index-js" class="sidebar-link">index.js</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/babel.html#package-json" class="sidebar-link">package.json</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/babel.html#转换结果" class="sidebar-link">转换结果</a></li></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/babel.html#ast语法" class="sidebar-link">ast语法</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/babel.html#ast-babel纯node形式" class="sidebar-link">ast-babel纯node形式</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/babel.html#实验20230208" class="sidebar-link">实验20230208</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="babel7"><a href="#babel7" class="header-anchor">#</a> babel7</h2> <p>babel7 引入@,比如 babel-cli 变成了 @babel/cli</p> <h2 id="webpack-babel环境"><a href="#webpack-babel环境" class="header-anchor">#</a> webpack+babel环境</h2> <p>webpack引入babel-loader 来使用babel</p> <p>.babelrc</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">&quot;@babel/env&quot;</span><span class="token punctuation">,</span>   <span class="token comment">// 只指定这个，箭头函数会转成 fuction(){}</span>
      <span class="token punctuation">{</span>
        <span class="token string">&quot;useBuiltIns&quot;</span><span class="token operator">:</span> <span class="token string">&quot;usage&quot;</span><span class="token punctuation">,</span>  <span class="token comment">// 按需加载后，会根据设置的浏览器来判断要不要转换箭头函数</span>
        <span class="token string">&quot;corejs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;version&quot;</span><span class="token operator">:</span> <span class="token number">3</span>   <span class="token comment">// 按需加载必须指定 core-js, 转换promise</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;targets&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;edge&quot;</span><span class="token operator">:</span> <span class="token string">&quot;17&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;firefox&quot;</span><span class="token operator">:</span> <span class="token string">&quot;60&quot;</span><span class="token punctuation">,</span>  <span class="token comment">// 版本要好好填， 60和70的差异是很大的</span>
          <span class="token string">&quot;chrome&quot;</span><span class="token operator">:</span> <span class="token string">&quot;67&quot;</span><span class="token punctuation">,</span>  <span class="token comment">// 设为30时，箭头函数会转为function()  设为67等高版本chrome，浏览器本身已支持函数函数，不需要转， 推荐在webapck mode:development下看效果，生产环境的箭头函数要调用才能看到效果</span>
          <span class="token string">&quot;safari&quot;</span><span class="token operator">:</span> <span class="token string">&quot;11.1&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;ie&quot;</span><span class="token operator">:</span><span class="token number">11</span>   <span class="token comment">// ie11 打包文件就100k了</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token comment">//  &quot;@babel/plugin-transform-runtime&quot;   // 打包会变小一点，但import功能失效</span>
  <span class="token punctuation">]</span>    
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>以上配置，几乎所有es6都可以转换并兼容ie11,但ie11 proxy还是解决不了</p></blockquote> <p>也可在webapck中直接添加babel配置，这种配置不明显</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.build.config.js</span>
<span class="token punctuation">{</span>test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
  loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
  exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
  options<span class="token operator">:</span> <span class="token punctuation">{</span>
    presets<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;@babel/env&quot;</span><span class="token punctuation">]</span>  
  <span class="token comment">// ... babel配置</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>  
        
</code></pre></div><p>package.json</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@babel/core&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.10.5&quot;</span><span class="token punctuation">,</span>    
    <span class="token property">&quot;@babel/preset-env&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.10.4&quot;</span><span class="token punctuation">,</span>   <span class="token comment">// 简写 @babel/env 转换箭头函数，依赖 @babel/core </span>
    <span class="token property">&quot;babel-loader&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.1.0&quot;</span><span class="token punctuation">,</span>         
    <span class="token property">&quot;core-js&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.6.5&quot;</span><span class="token punctuation">,</span>         <span class="token comment">// 转换所有es6</span>
    <span class="token property">&quot;webpack&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.43.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;webpack-cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.3.12&quot;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>其他</p> <div class="language-json extra-class"><pre class="language-json"><code>'@babel/plugin-syntax-dynamic-import'<span class="token punctuation">,</span>   <span class="token comment">// 动态import 【发现不需要】</span>
'@babel/plugin-proposal-optional-chaining'<span class="token punctuation">,</span>  <span class="token comment">// 可选链   console.log(obj?.abc?.def) 【发现不需要】</span>
<span class="token string">&quot;@babel/plugin-transform-runtime&quot;</span>  <span class="token comment">// 打包会变小一点，但import功能失效,暂时解决不了  </span>
<span class="token property">&quot;babel-plugin-proxy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.1.0&quot;</span><span class="token punctuation">,</span>   <span class="token comment">// ie11 proxy 还是解决不了</span>
<span class="token string">&quot;@babel/polyfill&quot;</span>：<span class="token string">&quot;xx&quot;</span> <span class="token comment">// 为所有API增加兼容方法   太多了 babel7.4拆成两个，详见官网</span>
<span class="token comment">//plugin-proposal-x 表示该插件是stageX（位于草案中的插件） </span>
</code></pre></div><h2 id="babel7环境搭建简单版"><a href="#babel7环境搭建简单版" class="header-anchor">#</a> babel7环境搭建简单版</h2> <div class="language- extra-class"><pre class="language-text"><code>yarn add -D @babel/core @babel/cli @babel/preset-env
</code></pre></div><p>babel.config.json 抄自官网  改名为 babel.config.js 才可以引入其他js 并 module.exports={ ... }</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">&quot;targets&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;edge&quot;</span><span class="token operator">:</span> <span class="token string">&quot;17&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;firefox&quot;</span><span class="token operator">:</span> <span class="token string">&quot;60&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;chrome&quot;</span><span class="token operator">:</span> <span class="token string">&quot;30&quot;</span><span class="token punctuation">,</span>   <span class="token comment">// 20230131跟版本有关系，改为30，则会转换箭头函数，官网是67，core-js 不用安装,其他细节见上面老配置</span>
          <span class="token string">&quot;safari&quot;</span><span class="token operator">:</span> <span class="token string">&quot;11.1&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;useBuiltIns&quot;</span><span class="token operator">:</span> <span class="token string">&quot;usage&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;corejs&quot;</span><span class="token operator">:</span> <span class="token string">&quot;3.6.5&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>package.json</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;start&quot;: &quot;babel index.js --out-dir lib&quot;  // 用babel直接转
&quot;devDependencies&quot;: {
    &quot;@babel/cli&quot;: &quot;^7.20.7&quot;,
    &quot;@babel/core&quot;: &quot;^7.20.12&quot;,
    &quot;@babel/preset-env&quot;: &quot;^7.20.2&quot;
  }
</code></pre></div><h2 id="ast"><a href="#ast" class="header-anchor">#</a> ast</h2> <p><a href="https://astexplorer.net/#/" target="_blank" rel="noopener noreferrer">ast explorer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>     @babel/parser 使用 acorn来解析</p> <h2 id="ast-babel插件形式"><a href="#ast-babel插件形式" class="header-anchor">#</a> ast-babel插件形式</h2> <p>改变量，改值，改console.log</p> <p><a href="https://juejin.cn/post/7146976516692410376#heading-30" target="_blank" rel="noopener noreferrer">参考<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://juejin.cn/post/6844904035271573511" target="_blank" rel="noopener noreferrer">参考<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>插件基本语法</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">babel</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span><span class="token punctuation">{</span>
    visitor<span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token function">VariableDeclarator</span><span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span>state</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>id<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>  
</code></pre></div><h3 id="plugintest-js"><a href="#plugintest-js" class="header-anchor">#</a> pluginTest.js</h3> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">babel</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span><span class="token punctuation">{</span>
    visitor<span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token function">VariableDeclarator</span><span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span>state</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 固定语法，改变量</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>id<span class="token punctuation">.</span>name<span class="token operator">===</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>id<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">'b'</span>   <span class="token comment">// 改变量</span>
          path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>int<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">100</span>  <span class="token comment">// 改变量值  </span>
          path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>init <span class="token operator">=</span> babel<span class="token punctuation">.</span>types<span class="token punctuation">.</span><span class="token function">stringLiteral</span><span class="token punctuation">(</span><span class="token string">&quot;ahaha&quot;</span><span class="token punctuation">)</span>   <span class="token comment">// 改变量值字符串</span>
          path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>init <span class="token operator">=</span> babel<span class="token punctuation">.</span>types<span class="token punctuation">.</span><span class="token function">numericLiteral</span><span class="token punctuation">(</span><span class="token number">888</span><span class="token punctuation">)</span>    <span class="token comment">// // 改变量值数字</span>
          
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>id<span class="token punctuation">.</span>name<span class="token operator">===</span><span class="token string">'arr'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">let</span> arr <span class="token operator">=</span> path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>init<span class="token punctuation">.</span>elements
          arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>babel<span class="token punctuation">.</span>types<span class="token punctuation">.</span><span class="token function">stringLiteral</span><span class="token punctuation">(</span><span class="token string">'haha'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 改数组</span>
          arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>babel<span class="token punctuation">.</span>types<span class="token punctuation">.</span><span class="token function">numericLiteral</span><span class="token punctuation">(</span><span class="token number">888</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>，
      <span class="token function">CallExpression</span><span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span>state</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">/*        let a = path.get('callee')
        if(a){
          path.remove()  // 删除
        }*/</span>
        <span class="token keyword">let</span> callee <span class="token operator">=</span> path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>callee
        <span class="token comment">// const isConsoleLog = babel.types.isMemberExpression(callee) &amp;&amp; callee.object.name==='console'</span>
        <span class="token keyword">const</span> isConsoleLog <span class="token operator">=</span> callee<span class="token punctuation">.</span>type <span class="token operator">===</span><span class="token string">'MemberExpression'</span> <span class="token operator">&amp;&amp;</span> callee<span class="token punctuation">.</span>object<span class="token punctuation">.</span>name<span class="token operator">===</span><span class="token string">'console'</span>
        <span class="token operator">&amp;&amp;</span> callee<span class="token punctuation">.</span>property<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'log'</span>  <span class="token comment">// console.log判断</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>isConsoleLog<span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">const</span> funcPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">findParent</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>   <span class="token comment">// 找出父级的函数path</span>
            <span class="token keyword">return</span> p<span class="token punctuation">.</span><span class="token function">isFunctionDeclaration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token keyword">const</span> funcName <span class="token operator">=</span> funcPath<span class="token punctuation">.</span>node<span class="token punctuation">.</span>id<span class="token punctuation">.</span>name  <span class="token comment">// 函数名</span>
          path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>arguments<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>babel<span class="token punctuation">.</span>types<span class="token punctuation">.</span><span class="token function">stringLiteral</span><span class="token punctuation">(</span>funcName<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// 参数追加函数名</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="babel-config-js"><a href="#babel-config-js" class="header-anchor">#</a> babel.config.js</h3> <div class="language- extra-class"><pre class="language-text"><code>const test = require('./pluginTest')
module.exports = {
  &quot;presets&quot;:[],
  &quot;plugins&quot;:[test]
}
</code></pre></div><p>利用纯babel转换</p> <h3 id="index-js"><a href="#index-js" class="header-anchor">#</a> index.js</h3> <div class="language- extra-class"><pre class="language-text"><code>const a = 10
let arr = [123]
function getData(){
  console.log('666')
}
function fn(){
  console.log('fn')
}

</code></pre></div><h3 id="package-json"><a href="#package-json" class="header-anchor">#</a> package.json</h3> <div class="language- extra-class"><pre class="language-text"><code>babel index.js --out-dir lib
</code></pre></div><h3 id="转换结果"><a href="#转换结果" class="header-anchor">#</a> 转换结果</h3> <p>lib/index.js</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;use strict&quot;;

var b = 100;
var arr = [123, &quot;haha&quot;, 888];
function getData() {
  console.log(&quot;getData&quot;, '666');
}
function fn() {
  console.log(&quot;fn&quot;, 'fn');
}
</code></pre></div><h2 id="ast语法"><a href="#ast语法" class="header-anchor">#</a> ast语法</h2> <div class="language- extra-class"><pre class="language-text"><code>literal 字面量  StringLiteral 字符串字面量   let a = 'abc'    abc是字面量
Identifer 标识符   变量名、属性名、参数名等     let a = 'abc'     a是标识符
statement 语句  for(xxx){}
Declaration  声明语句   let a = 'abc' 整个是
Expression 表达式 [1,2,3]  a=1等
</code></pre></div><p><a href="https://juejin.cn/post/7189795041765195834" target="_blank" rel="noopener noreferrer">语法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="ast-babel纯node形式"><a href="#ast-babel纯node形式" class="header-anchor">#</a> ast-babel纯node形式</h2> <p>改变量, 改对象 ，改数组对象</p> <p>纯node 需要引入babel包，以及需要读写文件，不一定方便</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> generator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/generator&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> parser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/parser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> traverse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/traverse&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> types <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/types&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">compile</span><span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1.parse 将代码解析为抽象语法树（AST）</span>
  <span class="token keyword">const</span> ast <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> vistor <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">VariableDeclarator</span><span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span>state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>id<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>id<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'b'</span>
        path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>init <span class="token operator">=</span> types<span class="token punctuation">.</span><span class="token function">stringLiteral</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>id<span class="token punctuation">.</span>name<span class="token operator">===</span><span class="token string">'obj'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  
          <span class="token keyword">let</span> objs <span class="token operator">=</span> types<span class="token punctuation">.</span><span class="token function">objectProperty</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span><span class="token string">'score'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>types<span class="token punctuation">.</span><span class="token function">numericLiteral</span><span class="token punctuation">(</span><span class="token number">95</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>init<span class="token punctuation">.</span>properties<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>objs<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>id<span class="token punctuation">.</span>name<span class="token operator">===</span><span class="token string">'obj2'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> obj <span class="token operator">=</span> types<span class="token punctuation">.</span><span class="token function">objectExpression</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
          types<span class="token punctuation">.</span><span class="token function">objectProperty</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>types<span class="token punctuation">.</span><span class="token function">stringLiteral</span><span class="token punctuation">(</span><span class="token string">'kang'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          types<span class="token punctuation">.</span><span class="token function">objectProperty</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>types<span class="token punctuation">.</span><span class="token function">numericLiteral</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span>
        path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>init<span class="token punctuation">.</span>elements<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 2,traverse 转换代码</span>
  <span class="token comment">// traverse.default(ast, {});</span>
  traverse<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> vistor<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 3. generator 将 AST 转回成代码</span>
  <span class="token keyword">return</span> generator<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 写死的源文件</span>
<span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
const a = 1
let obj = {
  age:12
}
let obj2 = [
  {name:1,age:100}
]
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newCode <span class="token operator">=</span> <span class="token function">compile</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newCode<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>结果</p> <div class="language- extra-class"><pre class="language-text"><code>const b = &quot;abc&quot;;
let obj = {
  age: 12,
  &quot;score&quot;: 95
};
let obj2 = [{
  name: 1,
  age: 100
}, {
  name: &quot;kang&quot;,
  age: &quot;30&quot;
}];
</code></pre></div><p>读写文件</p> <div class="language- extra-class"><pre class="language-text"><code>let path = './index.js'
let distPath = './dist/bundle.js'
const code = fs.readFileSync(path,'utf8')
fs.writeFileSync(distPath,code)
</code></pre></div><p><a href="https://www.ab62.cn/article/6901.html" target="_blank" rel="noopener noreferrer">参考<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://juejin.cn/post/6844903849442934798" target="_blank" rel="noopener noreferrer">从0实现babel功能<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="实验20230208"><a href="#实验20230208" class="header-anchor">#</a> 实验20230208</h2> <p>有用结论：</p> <p>1 纯babel转不了promise，借助webpack就可以</p> <p>2 火狐27版本  https://ftp.mozilla.org/pub/firefox/releases/27.0.1/win32/zh-CN/  左上角Firefox-选项-高级-更新里设置，取消更新，  不支持Promise</p> <p>package.json</p> <div class="language- extra-class"><pre class="language-text"><code> &quot;scripts&quot;: {
    &quot;start&quot;: &quot;babel main.js -o compiled.js&quot;
  },
&quot;devDependencies&quot;: {
    &quot;@babel/cli&quot;: &quot;^7.20.7&quot;,
    &quot;@babel/core&quot;: &quot;^7.20.12&quot;,
    &quot;@babel/preset-env&quot;: &quot;^7.20.2&quot;
  }
</code></pre></div><p>main.js</p> <div class="language- extra-class"><pre class="language-text"><code>var fn = (num) =&gt; num + 2;
var promise = Promise.resolve('ok')
</code></pre></div><p>结论1：转了等于没转，默认不转</p> <p>添加babel.config.js</p> <div class="language- extra-class"><pre class="language-text"><code>module.exports = {
  presets: [&quot;@babel/env&quot;], // 默认转所有es6语法为es5
  plugins: []
}
</code></pre></div><p>结论2：箭头函数会转普通数据，promise还是没转</p> <div class="language- extra-class"><pre class="language-text"><code>// `@babel/plugin-transform-runtime`？？

import &quot;core-js/stable&quot;;
import &quot;regenerator-runtime/runtime&quot;;  // 全引入了，部分引入怎么办？
// 引入这两个来替换 import &quot;@babel/polyfill&quot; ？？？
</code></pre></div><p>结论3：使用useBuiltIns时，要指定corejs版本，默认为2，最新是3</p> <p>结论4：参数modules不设置，默认为'auto'  , import {fn} from './a.js'代码会转为require</p> <p>结论5：class 类的代码会转成一堆辅助函数</p> <p>结论6： 优化结论5，补充@babel/runtime包，提供辅助函数库，补充@babel/plugin-transform-runtime来打包后自动引用辅助函数库</p> <p>结论：如果不配置useBuiltIns， polyfill会引入全部代码（未验证）</p> <p>https://www.jiangruitao.com/babel/ 最终没啥收获。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6f322a7c.js" defer></script><script src="/assets/js/2.5281df64.js" defer></script><script src="/assets/js/34.564690e0.js" defer></script>
  </body>
</html>
