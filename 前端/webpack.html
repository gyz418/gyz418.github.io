<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack4 | gyz418</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.7c4bcbe6.css" as="style"><link rel="preload" href="/assets/js/app.6f322a7c.js" as="script"><link rel="preload" href="/assets/js/2.5281df64.js" as="script"><link rel="preload" href="/assets/js/11.3979c63f.js" as="script"><link rel="prefetch" href="/assets/js/10.b5b78ec7.js"><link rel="prefetch" href="/assets/js/12.ad66bd03.js"><link rel="prefetch" href="/assets/js/13.8c156ce0.js"><link rel="prefetch" href="/assets/js/14.d5aaf7c9.js"><link rel="prefetch" href="/assets/js/15.744185ba.js"><link rel="prefetch" href="/assets/js/16.b223ec11.js"><link rel="prefetch" href="/assets/js/17.27940440.js"><link rel="prefetch" href="/assets/js/18.2561b5d6.js"><link rel="prefetch" href="/assets/js/19.bab52827.js"><link rel="prefetch" href="/assets/js/20.64459c18.js"><link rel="prefetch" href="/assets/js/21.95850c08.js"><link rel="prefetch" href="/assets/js/22.8b92906a.js"><link rel="prefetch" href="/assets/js/23.a2fee047.js"><link rel="prefetch" href="/assets/js/24.a1a3b298.js"><link rel="prefetch" href="/assets/js/25.ba19b2b6.js"><link rel="prefetch" href="/assets/js/26.753266fe.js"><link rel="prefetch" href="/assets/js/27.ee58b5d1.js"><link rel="prefetch" href="/assets/js/28.611ffe65.js"><link rel="prefetch" href="/assets/js/29.d446cc43.js"><link rel="prefetch" href="/assets/js/3.d5898f06.js"><link rel="prefetch" href="/assets/js/30.71c0d378.js"><link rel="prefetch" href="/assets/js/31.43e00d33.js"><link rel="prefetch" href="/assets/js/32.a6757d5d.js"><link rel="prefetch" href="/assets/js/33.bfb83c0e.js"><link rel="prefetch" href="/assets/js/34.564690e0.js"><link rel="prefetch" href="/assets/js/35.77a7c9e4.js"><link rel="prefetch" href="/assets/js/36.5e974fda.js"><link rel="prefetch" href="/assets/js/37.f0956a85.js"><link rel="prefetch" href="/assets/js/38.c42b9666.js"><link rel="prefetch" href="/assets/js/39.7262da55.js"><link rel="prefetch" href="/assets/js/4.eb70c47d.js"><link rel="prefetch" href="/assets/js/40.95d088a9.js"><link rel="prefetch" href="/assets/js/41.f7067891.js"><link rel="prefetch" href="/assets/js/42.12cf6162.js"><link rel="prefetch" href="/assets/js/43.7970973b.js"><link rel="prefetch" href="/assets/js/44.701b85aa.js"><link rel="prefetch" href="/assets/js/45.4c06d258.js"><link rel="prefetch" href="/assets/js/46.e5e18c20.js"><link rel="prefetch" href="/assets/js/47.5d0f9322.js"><link rel="prefetch" href="/assets/js/48.03ad2213.js"><link rel="prefetch" href="/assets/js/49.65826398.js"><link rel="prefetch" href="/assets/js/5.8e0377fa.js"><link rel="prefetch" href="/assets/js/50.8a4a5a58.js"><link rel="prefetch" href="/assets/js/6.49592538.js"><link rel="prefetch" href="/assets/js/7.c7371c19.js"><link rel="prefetch" href="/assets/js/8.78f8209a.js"><link rel="prefetch" href="/assets/js/9.823e0afe.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7c4bcbe6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">gyz418</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/前端/es6.html" class="nav-link">
  es6
</a></li><li class="dropdown-item"><!----> <a href="/前端/vue.html" class="nav-link">
  vue
</a></li><li class="dropdown-item"><!----> <a href="/前端/ts.html" class="nav-link">
  ts
</a></li><li class="dropdown-item"><!----> <a href="/前端/flutter.html" class="nav-link">
  flutter
</a></li><li class="dropdown-item"><!----> <a href="/前端/css.html" class="nav-link">
  css
</a></li><li class="dropdown-item"><!----> <a href="/前端/git.html" class="nav-link">
  git
</a></li><li class="dropdown-item"><!----> <a href="/前端/webpack.html" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/前端/nodejs.html" class="nav-link">
  nodejs
</a></li><li class="dropdown-item"><!----> <a href="/前端/js优化.html" class="nav-link">
  js优化
</a></li><li class="dropdown-item"><!----> <a href="/前端/vue2源码.html" class="nav-link">
  vue2源码
</a></li><li class="dropdown-item"><!----> <a href="/前端/babel.html" class="nav-link">
  babel
</a></li><li class="dropdown-item"><!----> <a href="/前端/vue3.html" class="nav-link">
  vue3
</a></li><li class="dropdown-item"><!----> <a href="/前端/js设计模式.html" class="nav-link">
  js设计模式
</a></li><li class="dropdown-item"><!----> <a href="/前端/小程序.html" class="nav-link">
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/前端/package.json.html" class="nav-link">
  package.json
</a></li><li class="dropdown-item"><!----> <a href="/前端/github.html" class="nav-link">
  github
</a></li><li class="dropdown-item"><!----> <a href="/前端/eslint.html" class="nav-link">
  eslint
</a></li><li class="dropdown-item"><!----> <a href="/前端/nestjs.html" class="nav-link">
  nestjs
</a></li><li class="dropdown-item"><!----> <a href="/前端/ueditor.html" class="nav-link">
  ueditor
</a></li><li class="dropdown-item"><!----> <a href="/typescript.html" class="nav-link">
  typescript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端相关" class="dropdown-title"><span class="title">前端相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/gulp.html" class="nav-link">
  gulp
</a></li><li class="dropdown-item"><!----> <a href="/react.html" class="nav-link">
  react
</a></li><li class="dropdown-item"><!----> <a href="/js-tools.html" class="nav-link">
  js-tools
</a></li><li class="dropdown-item"><!----> <a href="/js特效.html" class="nav-link">
  js特效
</a></li><li class="dropdown-item"><!----> <a href="/old.html" class="nav-link">
  old
</a></li><li class="dropdown-item"><!----> <a href="/js概念.html" class="nav-link">
  js概念
</a></li><li class="dropdown-item"><!----> <a href="/jest.html" class="nav-link">
  jest
</a></li><li class="dropdown-item"><!----> <a href="/微前端.html" class="nav-link">
  微前端
</a></li><li class="dropdown-item"><!----> <a href="/service worker.html" class="nav-link">
  service worker
</a></li><li class="dropdown-item"><!----> <a href="/deno.html" class="nav-link">
  deno
</a></li><li class="dropdown-item"><!----> <a href="/swiper.html" class="nav-link">
  swiper
</a></li><li class="dropdown-item"><!----> <a href="/nginx.html" class="nav-link">
  nginx
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/chrome.html" class="nav-link">
  chrome
</a></li><li class="dropdown-item"><!----> <a href="/vscode.html" class="nav-link">
  vscode
</a></li><li class="dropdown-item"><!----> <a href="/webstorm.html" class="nav-link">
  webstorm
</a></li><li class="dropdown-item"><!----> <a href="/url.html" class="nav-link">
  url
</a></li><li class="dropdown-item"><!----> <a href="/pc.html" class="nav-link">
  pc
</a></li><li class="dropdown-item"><!----> <a href="/festival.html" class="nav-link">
  festival
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/前端/es6.html" class="nav-link">
  es6
</a></li><li class="dropdown-item"><!----> <a href="/前端/vue.html" class="nav-link">
  vue
</a></li><li class="dropdown-item"><!----> <a href="/前端/ts.html" class="nav-link">
  ts
</a></li><li class="dropdown-item"><!----> <a href="/前端/flutter.html" class="nav-link">
  flutter
</a></li><li class="dropdown-item"><!----> <a href="/前端/css.html" class="nav-link">
  css
</a></li><li class="dropdown-item"><!----> <a href="/前端/git.html" class="nav-link">
  git
</a></li><li class="dropdown-item"><!----> <a href="/前端/webpack.html" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/前端/nodejs.html" class="nav-link">
  nodejs
</a></li><li class="dropdown-item"><!----> <a href="/前端/js优化.html" class="nav-link">
  js优化
</a></li><li class="dropdown-item"><!----> <a href="/前端/vue2源码.html" class="nav-link">
  vue2源码
</a></li><li class="dropdown-item"><!----> <a href="/前端/babel.html" class="nav-link">
  babel
</a></li><li class="dropdown-item"><!----> <a href="/前端/vue3.html" class="nav-link">
  vue3
</a></li><li class="dropdown-item"><!----> <a href="/前端/js设计模式.html" class="nav-link">
  js设计模式
</a></li><li class="dropdown-item"><!----> <a href="/前端/小程序.html" class="nav-link">
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/前端/package.json.html" class="nav-link">
  package.json
</a></li><li class="dropdown-item"><!----> <a href="/前端/github.html" class="nav-link">
  github
</a></li><li class="dropdown-item"><!----> <a href="/前端/eslint.html" class="nav-link">
  eslint
</a></li><li class="dropdown-item"><!----> <a href="/前端/nestjs.html" class="nav-link">
  nestjs
</a></li><li class="dropdown-item"><!----> <a href="/前端/ueditor.html" class="nav-link">
  ueditor
</a></li><li class="dropdown-item"><!----> <a href="/typescript.html" class="nav-link">
  typescript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端相关" class="dropdown-title"><span class="title">前端相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/gulp.html" class="nav-link">
  gulp
</a></li><li class="dropdown-item"><!----> <a href="/react.html" class="nav-link">
  react
</a></li><li class="dropdown-item"><!----> <a href="/js-tools.html" class="nav-link">
  js-tools
</a></li><li class="dropdown-item"><!----> <a href="/js特效.html" class="nav-link">
  js特效
</a></li><li class="dropdown-item"><!----> <a href="/old.html" class="nav-link">
  old
</a></li><li class="dropdown-item"><!----> <a href="/js概念.html" class="nav-link">
  js概念
</a></li><li class="dropdown-item"><!----> <a href="/jest.html" class="nav-link">
  jest
</a></li><li class="dropdown-item"><!----> <a href="/微前端.html" class="nav-link">
  微前端
</a></li><li class="dropdown-item"><!----> <a href="/service worker.html" class="nav-link">
  service worker
</a></li><li class="dropdown-item"><!----> <a href="/deno.html" class="nav-link">
  deno
</a></li><li class="dropdown-item"><!----> <a href="/swiper.html" class="nav-link">
  swiper
</a></li><li class="dropdown-item"><!----> <a href="/nginx.html" class="nav-link">
  nginx
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/chrome.html" class="nav-link">
  chrome
</a></li><li class="dropdown-item"><!----> <a href="/vscode.html" class="nav-link">
  vscode
</a></li><li class="dropdown-item"><!----> <a href="/webstorm.html" class="nav-link">
  webstorm
</a></li><li class="dropdown-item"><!----> <a href="/url.html" class="nav-link">
  url
</a></li><li class="dropdown-item"><!----> <a href="/pc.html" class="nav-link">
  pc
</a></li><li class="dropdown-item"><!----> <a href="/festival.html" class="nav-link">
  festival
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>webpack4</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/%E5%89%8D%E7%AB%AF/webpack.html#webpack4" class="sidebar-link">webpack4</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/webpack.html#webpack插件" class="sidebar-link">webpack插件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#demo1入门" class="sidebar-link">demo1入门</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#demo2-没结果" class="sidebar-link">demo2 没结果</a></li></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/webpack.html#webpack5-修改图片打包路径" class="sidebar-link">webpack5 修改图片打包路径</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/webpack.html#webpack4-2" class="sidebar-link">webpack4</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#一行代码打包1" class="sidebar-link">一行代码打包1</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#一行代码打包2：" class="sidebar-link">一行代码打包2：</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#开发服务" class="sidebar-link">开发服务</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#特点" class="sidebar-link">特点</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#问题" class="sidebar-link">问题</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#source-map" class="sidebar-link">source-map</a></li></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/webpack.html#开发优化" class="sidebar-link">开发优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#hmr" class="sidebar-link">hmr</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#sourcemap" class="sidebar-link">sourcemap</a></li></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/webpack.html#打包优化" class="sidebar-link">打包优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#one-of" class="sidebar-link">one-of</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#缓存" class="sidebar-link">缓存</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#tree-shaking" class="sidebar-link">tree shaking</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#code-split" class="sidebar-link">code split</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#懒加载-预加载" class="sidebar-link">懒加载/预加载</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#pwa" class="sidebar-link">pwa</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#offline-plugin" class="sidebar-link">offline-plugin</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#多进程打包" class="sidebar-link">多进程打包</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#cache-loader" class="sidebar-link">cache-loader</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#externals" class="sidebar-link">externals</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#dll" class="sidebar-link">dll</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#browserslist" class="sidebar-link">browserslist</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#provideplugin" class="sidebar-link">providePlugin</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#ignoreplugin" class="sidebar-link">IgnorePlugin</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#preload-webpack-plugin" class="sidebar-link">preload-webpack-plugin</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#pnp-webpack-plugin" class="sidebar-link">pnp-webpack-plugin</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#minimist" class="sidebar-link">minimist</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#case-sensitive-paths-webpack-plugin" class="sidebar-link">case-sensitive-paths-webpack-plugin</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#address" class="sidebar-link">address</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#gzip压缩" class="sidebar-link">gzip压缩</a></li></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/webpack.html#以上优化分类" class="sidebar-link">以上优化分类</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/webpack.html#package-json" class="sidebar-link">package.json</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/webpack.html#其他插件" class="sidebar-link">其他插件</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/webpack.html#webpack-chain" class="sidebar-link">webpack-chain</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/webpack.html#笔记在对应项目中" class="sidebar-link">笔记在对应项目中</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/webpack.html#入门20221212" class="sidebar-link">入门20221212</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#打包分析" class="sidebar-link">打包分析</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#watch功能" class="sidebar-link">watch功能</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/webpack.html#serve功能" class="sidebar-link">serve功能</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="webpack4"><a href="#webpack4" class="header-anchor">#</a> webpack4</h2> <h2 id="webpack插件"><a href="#webpack插件" class="header-anchor">#</a> webpack插件</h2> <div class="language- extra-class"><pre class="language-text"><code>tapable  注册自定义事件
compiler  webpack完整的生命周期,一次性建立
compilation   代表一次资源版本构建，开发时，检测到文件变化，会创建新的 compilation
</code></pre></div><h3 id="demo1入门"><a href="#demo1入门" class="header-anchor">#</a> demo1入门</h3> <p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> testPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./src/plugin'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span><span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span><span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span><span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">testPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>   <span class="token comment">// 使用插件</span>
<span class="token punctuation">}</span>
</code></pre></div><p>plugin.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">TestPlugin</span><span class="token punctuation">{</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'demoPlugin'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span>callback</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'demoPlugin: 编译结束了'</span><span class="token punctuation">)</span>   <span class="token comment">// 基本语法     done是编译结束</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> TestPlugin
</code></pre></div><p><a href="https://juejin.cn/post/7160467329334607908" target="_blank" rel="noopener noreferrer">参考<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>https://webpack.docschina.org/api/compiler-hooks/   compiler钩子，按顺序 （官网）</p> <p>文档有标明钩子的类型  done: AsyncSeriesHook    emit: AsyncSeriesHook</p> <div class="language- extra-class"><pre class="language-text"><code>entryOption  entry配置项处理后执行
afterPlugins 设置完初始化插件后执行
compilation 编译后，执行
emit 生成文件到output目录前执行
done 编译完成
</code></pre></div><p>https://juejin.cn/post/7170852747749621791 插件源码实现</p> <p>loader是转换器，把a.less 转成 a.css</p> <p>plugin是扩展器，loader后，执行某些任务，如打包优化，压缩等</p> <h3 id="demo2-没结果"><a href="#demo2-没结果" class="header-anchor">#</a> demo2 没结果</h3> <p>https://webpack.docschina.org/contribute/writing-a-plugin/  自定义插件（官方文档）</p> <p>文档表示，异步钩子有多种写法</p> <p>文档例子api不懂，跳过</p> <div class="language- extra-class"><pre class="language-text"><code>有些插件钩子是异步的。我们可以像同步方式一样用 tap 方法来绑定，也可以用 tapAsync 或 tapPromise 这两个异步方法来绑定。
用 tapAsync 方法来绑定插件时，_必须_调用函数的最后一个参数 callback 指定的回调函数。
用 tapPromise 方法来绑定插件时，_必须_返回一个 pormise ，异步任务完成后 resolve 。
</code></pre></div><p>https://juejin.cn/post/6844904070868631560  改html-webpack-plugin插件</p> <p>https://juejin.cn/post/7047777251949019173 插件举例 创建压缩包，动态CDN</p> <p>换种思路，研究现成的插件怎么实现？感觉更难。</p> <p>《webpack实战：入门、进阶与调优》 讲webpack怎么用。。</p> <p>《深入浅出webpack》讲webpack3.8.1  loader和plugin没怎么说</p> <p>看书走不通</p> <p>利用Object.keys(xx) 看有什么属性</p> <h2 id="webpack5-修改图片打包路径"><a href="#webpack5-修改图片打包路径" class="header-anchor">#</a> webpack5 修改图片打包路径</h2> <p>file-loader 解决图片引入问题</p> <p>url-loader 转base64图片</p> <p>url-loader 封装了 file-loader</p> <div class="language-js extra-class"><pre class="language-js"><code>config<span class="token punctuation">.</span>module<span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">'images'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token regex">/\.(png|jpe?g|gif|webp|avif)(\?.*)?$/</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'javascript/auto'</span><span class="token punctuation">)</span>  <span class="token comment">// webpack5 图片打包重复处理</span>
      <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'url-loader'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">loader</span><span class="token punctuation">(</span>require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'url-loader'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        limit<span class="token operator">:</span> <span class="token number">10</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">,</span>   <span class="token comment">// 先用 url-loader 转 base64图片</span>
        esModule<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>   <span class="token comment">// 解决不加载图片 img src=[object Module]</span>
        fallback<span class="token operator">:</span><span class="token punctuation">{</span>         <span class="token comment">// 剩下的用file-loader处理</span>
          loader<span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'file-loader'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          options<span class="token operator">:</span><span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token string">&quot;[name].[contenthash].[ext]&quot;</span><span class="token punctuation">,</span>
            <span class="token function-variable function">outputPath</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> resourcePath<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">// outputPath只在file-loader才生效</span>
              <span class="token keyword">const</span> relativePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span>resourcePath<span class="token punctuation">)</span>
              <span class="token keyword">let</span> dir <span class="token operator">=</span> <span class="token string">'components'</span>
              <span class="token keyword">let</span> index <span class="token operator">=</span> relativePath<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span>
              <span class="token comment">// src\components\addFans1\res\head2.png</span>
              <span class="token keyword">let</span> path2 <span class="token operator">=</span> relativePath<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>index<span class="token operator">+</span>dir<span class="token punctuation">.</span>length<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
              <span class="token keyword">let</span> arr <span class="token operator">=</span> path2<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'\\'</span><span class="token punctuation">)</span>
              <span class="token keyword">if</span><span class="token punctuation">(</span>isMobile<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">img/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
              <span class="token punctuation">}</span>
              <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">img/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><a href="https://webpack.docschina.org/guides/asset-modules/#root" target="_blank" rel="noopener noreferrer">webpack5<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://codeantenna.com/a/F9lnk7gdnG" target="_blank" rel="noopener noreferrer">图片object module<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://blog.csdn.net/weixin_39838846/article/details/125225619" target="_blank" rel="noopener noreferrer">vue-cli4实现方式<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://segmentfault.com/a/1190000016186073" target="_blank" rel="noopener noreferrer">webpack-chain<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="webpack4-2"><a href="#webpack4-2" class="header-anchor">#</a> webpack4</h2> <p>webpack 4x以上，webpack将命令相关的内容都放到了webpack-cli
需要全局安装webpack-cli   webpack命令才有用。</p> <h3 id="一行代码打包1"><a href="#一行代码打包1" class="header-anchor">#</a> 一行代码打包1</h3> <ol><li><p>需要安装 <code>webpack webpack -D</code></p></li> <li><p>生产环境打包 <code>webpack src/a.js -o ./dist/res.js --mode=development</code></p></li> <li><p>正式环境打包 <code>webpack src/a.js -o ./dist/res.js --mode=production</code></p></li></ol> <h3 id="一行代码打包2："><a href="#一行代码打包2：" class="header-anchor">#</a> 一行代码打包2：</h3> <p>利用webpack.config.js 简单打包 <code>webpack</code></p> <h3 id="开发服务"><a href="#开发服务" class="header-anchor">#</a> 开发服务</h3> <p>利用 webpack-dev-server  配置一下webpack.config.js中的</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>
devServer<span class="token operator">:</span><span class="token punctuation">{</span>
  contentBase<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// gzip压缩</span>
  compress<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  port<span class="token operator">:</span> <span class="token number">3000</span>
<span class="token punctuation">}</span>
<span class="token comment">// 运行： npx webpack-dev-server</span>
</code></pre></div><h3 id="特点"><a href="#特点" class="header-anchor">#</a> 特点</h3> <ol><li>webpack可直接处理js/json</li> <li>webpack4有mode:'development'/'production' 开发/生产模式,两种模式下有一些默认配置</li> <li>webpack v4.26.0把默认的 uglifyjs-webpack-plugin改为terser-webpack-plugin,所以默认生产环境可以压缩js</li> <li>webpack4 抽取css用  mini-css-extract-plugin， webpack3抽取css用extract-text-webpack-plugin</li> <li>babel 转换箭头函数，解决低版本兼容</li> <li>postcss-preset-env 包含 autoprefixer (css前缀)</li></ol> <h3 id="问题"><a href="#问题" class="header-anchor">#</a> 问题</h3> <ol><li>完整的css各种打包细节太麻烦了，目前less文件中使用 @import后，postcss无法添加前缀</li></ol> <h3 id="source-map"><a href="#source-map" class="header-anchor">#</a> source-map</h3> <p>source-map: 一种 提供源代码到构建后代码映射 技术 （如果构建后代码出错了，通过映射可以追踪源代码错误）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/*
[inline-|hidden-|eval-][nosources-][cheap-[module-]]source-map

source-map：外部
  错误代码准确信息 和 源代码的错误位置
inline-source-map：内联
  只生成一个内联source-map
  错误代码准确信息 和 源代码的错误位置
hidden-source-map：外部
  错误代码错误原因，但是没有错误位置
  不能追踪源代码错误，只能提示到构建后代码的错误位置
eval-source-map：内联
  每一个文件都生成对应的source-map，都在eval
  错误代码准确信息 和 源代码的错误位置
nosources-source-map：外部
  错误代码准确信息, 但是没有任何源代码信息
cheap-source-map：外部
  错误代码准确信息 和 源代码的错误位置 
  只能精确的行
cheap-module-source-map：外部
  错误代码准确信息 和 源代码的错误位置 
  module会将loader的source map加入

内联 和 外部的区别：1. 外部生成了文件，内联没有 2. 内联构建速度更快

开发环境：速度快，调试更友好
  速度快(eval&gt;inline&gt;cheap&gt;...)
    eval-cheap-souce-map
    eval-source-map
  调试更友好  
    souce-map
    cheap-module-souce-map
    cheap-souce-map

  --&gt; eval-source-map  / eval-cheap-module-souce-map    //开发用 eval-source-map

生产环境：源代码要不要隐藏? 调试要不要更友好
  内联会让代码体积变大，所以在生产环境不用内联
  nosources-source-map 全部隐藏
  hidden-source-map 只隐藏源代码，会提示构建后代码错误信息

  --&gt; source-map / cheap-module-souce-map  // 生产用 source-map
*/</span>
</code></pre></div><h2 id="开发优化"><a href="#开发优化" class="header-anchor">#</a> 开发优化</h2> <h3 id="hmr"><a href="#hmr" class="header-anchor">#</a> hmr</h3> <p>css热更新、js太麻烦</p> <p>js处理</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// xx.js</span>
<span class="token keyword">import</span> aa <span class="token keyword">from</span> <span class="token string">'./aa.js'</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 一旦 module.hot 为true，说明开启了HMR功能。 --&gt; 让HMR功能代码生效</span>
  module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">'./aa.js'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 方法会监听 print.js 文件的变化，一旦发生变化，其他模块不会重新打包构建。</span>
    <span class="token comment">// 会执行后面的回调函数</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="sourcemap"><a href="#sourcemap" class="header-anchor">#</a> sourcemap</h3> <p>感觉不需要</p> <h2 id="打包优化"><a href="#打包优化" class="header-anchor">#</a> 打包优化</h2> <h3 id="one-of"><a href="#one-of" class="header-anchor">#</a> one-of</h3> <p>loader只加载一个，匹配到某loader后，后面就停止匹配</p> <h3 id="缓存"><a href="#缓存" class="header-anchor">#</a> 缓存</h3> <p>每次wepack构建时会生成一个唯一的hash值。</p> <div class="language- extra-class"><pre class="language-text"><code>/*
  缓存：
    babel缓存
      cacheDirectory: true
      --&gt; 让第二次打包构建速度更快
    文件资源缓存
      hash: 每次wepack构建时会生成一个唯一的hash值。
        问题: 因为js和css同时使用一个hash值。
          如果重新打包，会导致所有缓存失效。（可能我却只改动一个文件）
      chunkhash：根据chunk生成的hash值。如果打包来源于同一个chunk，那么hash值就一样
        问题: js和css的hash值还是一样的
          因为css是在js中被引入的，所以同属于一个chunk
      contenthash: 根据文件的内容生成hash值。不同文件hash值一定不一样    
      --&gt; 让代码上线运行缓存更好使用
*/
</code></pre></div><h3 id="tree-shaking"><a href="#tree-shaking" class="header-anchor">#</a> tree shaking</h3> <p>（树摇）去除无用代码，比如未使用的js函数不会被打包进去，减少代码体积</p> <div class="language-js extra-class"><pre class="language-js"><code> 前提：<span class="token number">1.</span> 必须使用<span class="token constant">ES6</span>模块化  <span class="token number">2.</span> 开启production环境
    作用<span class="token operator">:</span> 减少代码体积
    默认不需要 <span class="token keyword">package</span><span class="token punctuation">.</span>json配置，可能某些webpack版本会把css @babel<span class="token operator">/</span>polyfill等给删除，可通过 sideEffects<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;*.css&quot;</span><span class="token punctuation">]</span>来保留css等不被删除

    在<span class="token keyword">package</span><span class="token punctuation">.</span>json中配置 
      <span class="token string">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span> 所有代码都没有副作用（都可以进行tree shaking）
        问题：可能会把css <span class="token operator">/</span> @babel<span class="token operator">/</span>polyfill （副作用）文件干掉
      <span class="token string">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;*.css&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*.less&quot;</span><span class="token punctuation">]</span>
</code></pre></div><h3 id="code-split"><a href="#code-split" class="header-anchor">#</a> code split</h3> <p>代码分割：</p> <p>1.多入口</p> <p>2.webpack配置 splitChunks</p> <p>3.单独打包某js文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: 'test' */</span><span class="token string">'./js/c'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="懒加载-预加载"><a href="#懒加载-预加载" class="header-anchor">#</a> 懒加载/预加载</h3> <p>建立在code split的第3点 import()上， 预加载prefetch有兼容性问题，少用</p> <h3 id="pwa"><a href="#pwa" class="header-anchor">#</a> pwa</h3> <ol><li>serviceworker 离线缓存，有webpack插件</li> <li>需要在js中注册 serviceWorker</li> <li>最后打包出来的代码，必须运行在服务器才会生效</li></ol> <h3 id="offline-plugin"><a href="#offline-plugin" class="header-anchor">#</a> offline-plugin</h3> <p>又一个pwa方案  <a href="https://segmentfault.com/a/1190000010669126" target="_blank" rel="noopener noreferrer">介绍<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="多进程打包"><a href="#多进程打包" class="header-anchor">#</a> 多进程打包</h3> <h4 id="thread-loader"><a href="#thread-loader" class="header-anchor">#</a> thread-loader</h4> <p><code>yarn add thread-loader -D</code>  当js文件多时，提高加包速度</p> <p>用在babel-loader上，如果js代码太少，反而打包速度慢</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
  exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">/* 
      开启多进程打包。 
      进程启动大概为600ms，进程通信也有开销。
      只有工作消耗时间比较长，才需要多进程打包
    */</span>
    <span class="token punctuation">{</span>
        loader<span class="token operator">:</span> <span class="token string">'thread-loader'</span><span class="token punctuation">,</span>
        options<span class="token operator">:</span> <span class="token punctuation">{</span>
            workers<span class="token operator">:</span> <span class="token number">2</span> <span class="token comment">// 进程2个</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>   
</code></pre></div><h4 id="happypack"><a href="#happypack" class="header-anchor">#</a> happyPack</h4> <p><a href="https://juejin.im/post/5ee9c98c6fb9a0587c6b136c#heading-15" target="_blank" rel="noopener noreferrer">多进程打包<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 项目太小反而会慢</p> <h3 id="cache-loader"><a href="#cache-loader" class="header-anchor">#</a> cache-loader</h3> <p>在一些性能开销较大的 loader 之前添加 cache-loader，以便将结果缓存到磁盘里</p> <p>只打算给 <code>babel-loader</code> 配置 <code>cache</code> 的话，直接在 babel-loader 设置  cacheDirectory：true就行了，不用这个</p> <h3 id="externals"><a href="#externals" class="header-anchor">#</a> externals</h3> <p>不打包cdn</p> <p>要在html中手动引入cdn</p> <div class="language-js extra-class"><pre class="language-js"><code>externals<span class="token operator">:</span><span class="token punctuation">{</span>
  jquery<span class="token operator">:</span><span class="token string">'jQuery'</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="dll"><a href="#dll" class="header-anchor">#</a> dll</h3> <p>对node_modules中的jq vue react包单独打包</p> <p>（上面的code split 中的webpack配置 splitChunks会把 node_modules只打成一个包，可能体积太大）</p> <ol><li>需要先运行 webpack --config webpack.dll.js 执行 dll.js文件打包文件映射</li> <li>再在webpack.build.config.js再引入映射文件</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.dll.js</span>
<span class="token comment">/*
  使用dll技术，对某些库（第三方库：jquery、react、vue...）进行单独打包
    当你运行 webpack 时，默认查找 webpack.config.js 配置文件
    需求：需要运行 webpack.dll.js 文件
      --&gt; webpack --config webpack.dll.js
*/</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> resolve <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 最终打包生成的[name] --&gt; jquery</span>
    <span class="token comment">// ['jquery'] --&gt; 要打包的库是jquery</span>
    jquery<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'jquery'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dll'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    library<span class="token operator">:</span> <span class="token string">'[name]_[hash]'</span> <span class="token comment">// 打包的库里面向外暴露出去的内容叫什么名字</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 打包生成一个 manifest.json --&gt; 提供和jquery映射</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">'[name]_[hash]'</span><span class="token punctuation">,</span> <span class="token comment">// 映射库的暴露的内容名称</span>
      path<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dll/manifest.json'</span><span class="token punctuation">)</span> <span class="token comment">// 输出文件路径</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">'production'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> resolve <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> AddAssetHtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'add-asset-html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'built.js'</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'build'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token operator">:</span> <span class="token string">'./src/index.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 告诉webpack哪些库不参与打包，同时使用时的名称也得变~</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      manifest<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dll/manifest.json'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 将某个文件打包输出去，并在html中自动引入该资源</span>
    <span class="token keyword">new</span> <span class="token class-name">AddAssetHtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filepath<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dll/jquery.js'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">'production'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="browserslist"><a href="#browserslist" class="header-anchor">#</a> browserslist</h3> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;browserslist&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token string">&quot;&gt; 1%&quot;</span><span class="token punctuation">,</span>   <span class="token comment">// 全球浏览器使用率大于1%。</span>
  <span class="token string">&quot;last 2 versions&quot;</span><span class="token punctuation">,</span>   <span class="token comment">// 每个浏览器中最新的两个版本。</span>
  <span class="token string">&quot;not ie &lt;= 8&quot;</span>
<span class="token punctuation">]</span>
</code></pre></div><h3 id="provideplugin"><a href="#provideplugin" class="header-anchor">#</a> providePlugin</h3> <p><img src="/assets/img/3.245e8edc.png" alt="image-20200721181022970"></p> <h3 id="ignoreplugin"><a href="#ignoreplugin" class="header-anchor">#</a> IgnorePlugin</h3> <p>忽略第三方包指定目录   <a href="https://juejin.im/post/5ee9c98c6fb9a0587c6b136c#heading-17" target="_blank" rel="noopener noreferrer">IgnorePlugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="preload-webpack-plugin"><a href="#preload-webpack-plugin" class="header-anchor">#</a> preload-webpack-plugin</h3> <p>预加载 js css</p> <link rel="preload" as="script" href="chunk.31132ae6680e598f8879.js"> <h3 id="pnp-webpack-plugin"><a href="#pnp-webpack-plugin" class="header-anchor">#</a> pnp-webpack-plugin</h3> <p>加快node_modules 找模块的速度   <a href="https://juejin.im/post/5ca97b516fb9a05e132110fd" target="_blank" rel="noopener noreferrer">介绍<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="minimist"><a href="#minimist" class="header-anchor">#</a> minimist</h3> <p>轻量级的命令行参数解析引擎 <a href="https://jarvys.github.io/2014/06/01/minimist-js/" target="_blank" rel="noopener noreferrer">介绍<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="case-sensitive-paths-webpack-plugin"><a href="#case-sensitive-paths-webpack-plugin" class="header-anchor">#</a> case-sensitive-paths-webpack-plugin</h3> <p>防止不同的系统下对于大小写的问题导致路径出错</p> <h3 id="address"><a href="#address" class="header-anchor">#</a> address</h3> <p>获取ip地址</p> <h3 id="gzip压缩"><a href="#gzip压缩" class="header-anchor">#</a> gzip压缩</h3> <p>compression-webpack-plugin</p> <h2 id="以上优化分类"><a href="#以上优化分类" class="header-anchor">#</a> 以上优化分类</h2> <p>开发环境性能优化</p> <ul><li>优化打包构建速度
<ul><li>HMR</li></ul></li> <li>优化代码调试
<ul><li>source-map</li></ul></li></ul> <p>生产环境性能优化</p> <ul><li>优化打包构建速度
<ul><li>oneOf</li> <li>babel缓存</li> <li>多进程打包</li> <li>externals</li> <li>dll</li></ul></li> <li>优化代码运行的性能
<ul><li>缓存(hash-chunkhash-contenthash)</li> <li>tree shaking</li> <li>code split</li> <li>懒加载/预加载</li> <li>pwa</li></ul></li></ul> <h2 id="package-json"><a href="#package-json" class="header-anchor">#</a> package.json</h2> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;@babel/core&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.10.4&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;@babel/preset-env&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.10.4&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;babel-loader&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.1.0&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;clean-webpack-plugin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.0.0&quot;</span><span class="token punctuation">,</span>     <span class="token comment">// 清空文件夹</span>
<span class="token property">&quot;copy-webpack-plugin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^6.0.3&quot;</span><span class="token punctuation">,</span>      <span class="token comment">// 复制文件</span>
<span class="token property">&quot;core-js&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.6.5&quot;</span><span class="token punctuation">,</span>                  
<span class="token property">&quot;css-loader&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.6.0&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;eslint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.4.0&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;eslint-config-airbnb-base&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^14.2.0&quot;</span><span class="token punctuation">,</span>  <span class="token comment">// eslint的 airbnb标准</span>
<span class="token property">&quot;eslint-loader&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.0.2&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;eslint-plugin-import&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.22.0&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;file-loader&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^6.0.0&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;html-loader&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.1.0&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;html-webpack-plugin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.3.0&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;less&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.11.3&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;less-loader&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^6.2.0&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;mini-css-extract-plugin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.9.0&quot;</span><span class="token punctuation">,</span>   <span class="token comment">// 提取css </span>
<span class="token property">&quot;optimize-css-assets-webpack-plugin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.0.3&quot;</span><span class="token punctuation">,</span>   <span class="token comment">// 压缩css 前面依赖后面 cssnano也是压缩css</span>
<span class="token property">&quot;postcss-loader&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.0.0&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;postcss-preset-env&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^6.7.0&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;purify-css&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.2.5&quot;</span><span class="token punctuation">,</span>         <span class="token comment">// // 删除多余的css</span>
<span class="token property">&quot;purifycss-webpack&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.7.0&quot;</span><span class="token punctuation">,</span>  <span class="token comment">// 删除多余的css</span>
<span class="token property">&quot;style-loader&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.2.1&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;url-loader&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.1.0&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;webpack&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.43.0&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;webpack-cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.3.12&quot;</span><span class="token punctuation">,</span>  <span class="token comment">// webpack4 必装</span>
<span class="token property">&quot;webpack-dev-server&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.11.0&quot;</span><span class="token punctuation">,</span>   <span class="token comment">// server</span>
<span class="token property">&quot;workbox-webpack-plugin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.1.3&quot;</span>   <span class="token comment">// pwa</span>
</code></pre></div><h2 id="其他插件"><a href="#其他插件" class="header-anchor">#</a> 其他插件</h2> <ol><li><p>webpack-bundle-analyzer  生成代码分析报告，写webpack配置时才用？？</p></li> <li><p>webpack-merge  合并配置 webpack.common.js   webpack.dev.js webpack.production.js</p></li> <li><p>webpack-chain 链式配置webpack 。当项目的 webpack 配置需要根据某些逻辑生成的时候</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-chain'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
config
  <span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'src/index.js'</span><span class="token punctuation">)</span>
<span class="token comment">//它等价于 webpack 配置对象的这部分：</span>
entry<span class="token operator">:</span> <span class="token punctuation">{</span>
  app<span class="token operator">:</span> <span class="token string">'./src/index.js'</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>webpack-cdn-plugin  把vue.min.js 以cdn形式直接在html中script中引入</p></li></ol> <h2 id="webpack-chain"><a href="#webpack-chain" class="header-anchor">#</a> webpack-chain</h2> <div class="language-js extra-class"><pre class="language-js"><code>webpackConfig<span class="token punctuation">.</span>module
    <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">'eslint'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token regex">/\.(js|vue)$/</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pre</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>include
    <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>api<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'./src'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'eslint'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">loader</span><span class="token punctuation">(</span><span class="token string">'eslint-loader'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    	fix<span class="token operator">:</span><span class="token boolean">true</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><a href="https://segmentfault.com/a/1190000016186073" target="_blank" rel="noopener noreferrer">文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h1 id="webpack5"><a href="#webpack5" class="header-anchor">#</a> webpack5</h1> <p>yarn add webpack@next webpack-cli -D</p> <p>专注性能、tree shaking https://github.com/webpack/changelog-v5</p> <p>webpack包无穷无尽，有些包还会过时、冲突，真可怕~</p> <p><a href="https://juejin.im/post/6882663278712094727" target="_blank" rel="noopener noreferrer">webpack5<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>联邦模块 tree shaking  持久性缓存、长期缓存</p> <h2 id="笔记在对应项目中"><a href="#笔记在对应项目中" class="header-anchor">#</a> 笔记在对应项目中</h2> <h2 id="入门20221212"><a href="#入门20221212" class="header-anchor">#</a> 入门20221212</h2> <p>1 需要安装webapck -D , weback-cli不用全局  -D就行了</p> <p>webpack-cli 需要  node&gt;=14.15.0</p> <p>nvm use v18.12.0</p> <p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span><span class="token string">'development'</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span><span class="token string">'./index.js'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span><span class="token punctuation">{</span>
    filename<span class="token operator">:</span><span class="token string">'main.js'</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>package.json</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --config ./webpack.config.js&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;webpack&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.75.0&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;webpack-cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.0.1&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="打包分析"><a href="#打包分析" class="header-anchor">#</a> 打包分析</h3> <p>index.js</p> <div class="language- extra-class"><pre class="language-text"><code>function test(){
  console.log(123);
}
test()
</code></pre></div><p>打包后简化 main.js</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 	<span class="token keyword">var</span> __webpack_modules__ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
     <span class="token string">&quot;./index.js&quot;</span><span class="token operator">:</span>
     <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">&quot;function test(){\r\n  console.log(123);\r\n}\r\ntest()\n\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
     	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 	<span class="token keyword">var</span> __webpack_exports__ <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
 	__webpack_modules__<span class="token punctuation">[</span><span class="token string">&quot;./index.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 	<span class="token comment">// 类似</span>
 	<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'test1'</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token keyword">function</span> <span class="token function">test11</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'846'</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token function">test11</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
   obj<span class="token punctuation">[</span><span class="token string">'test1'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">;</span>
</code></pre></div><p>分析二：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// index.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>test<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./a&quot;</span><span class="token punctuation">;</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./b'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// a.js</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'this is a.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// b.js</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">testB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'this is bbb.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>打包后简化 main.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'./a.js'</span><span class="token operator">:</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">'a.js代码'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">'./index.js'</span><span class="token operator">:</span><span class="token function">eval</span><span class="token punctuation">(</span>'index<span class="token punctuation">.</span>js代码
                     <span class="token function">webpack_require</span><span class="token punctuation">(</span><span class="token string">'a.js'</span><span class="token punctuation">)</span> 
                     webpack_require<span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">'b.js'</span><span class="token punctuation">)</span>'<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">webpack_require</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   obj<span class="token punctuation">[</span>name<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token comment">// b.js加载后，把代码push到 obj,</span>
<span class="token function">webpack_require</span><span class="token punctuation">(</span><span class="token string">'./index.js'</span><span class="token punctuation">)</span>  <span class="token comment">// 执行</span>
</code></pre></div><p>import {test} from './a'  转成 <strong>webpack_require</strong>()</p> <p>import('./b.js').then()    转成  webpack_require.e().then()</p> <p>b.js会独立打包</p> <p>b.js动态加载完成后，会push到 main.js中去</p> <p>分析三</p> <p>module federation</p> <p>先加载远程的remoteEntry.js, 创建了一个全局obj, 提供方法去加载具体的模块。提供给程序调用模块</p> <p>分析四</p> <p>module federation 所有模块都可以独立打包，可提供给别的项目使用，也可以引入别人的项目，整合成一个项目，微前端的另一种实现方案。通过一些全局变量，可以访问加载其他项目</p> <h3 id="watch功能"><a href="#watch功能" class="header-anchor">#</a> watch功能</h3> <p>标准的src/index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack watch --mode development&quot;</span><span class="token punctuation">,</span>   <span class="token comment">// 代码没压缩 有__webpack_require__等代码</span>
<span class="token string">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack watch --mode production&quot;</span>    <span class="token comment">// 代码压缩了 (()=&gt;{&quot;use strict&quot;;console.log(&quot;test&quot;)})();</span>
</code></pre></div><p>index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>test<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./tool&quot;</span><span class="token punctuation">;</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token number">10</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> b  <span class="token operator">=</span> <span class="token number">20</span>
<span class="token keyword">let</span> c <span class="token operator">=</span> a<span class="token operator">+</span>b
document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
</code></pre></div><p>tool.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>压缩成 main.js</p> <div class="language- extra-class"><pre class="language-text"><code>(()=&gt;{&quot;use strict&quot;;console.log(&quot;test&quot;),document.write(30)})();
</code></pre></div><p>解决了import 没解决Promise async</p> <h3 id="serve功能"><a href="#serve功能" class="header-anchor">#</a> serve功能</h3> <p>开发服务器，不会用，没试出来，缺配置</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6f322a7c.js" defer></script><script src="/assets/js/2.5281df64.js" defer></script><script src="/assets/js/11.3979c63f.js" defer></script>
  </body>
</html>
